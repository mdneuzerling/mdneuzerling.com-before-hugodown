<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "",
        "name" : "mdneuzerling",
        "headline" : "mdneuzerling",
        "description" : "",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-07-01 00:00:00 &#43;0000 UTC",
        "dateModified" : "2018-07-01 00:00:00 &#43;0000 UTC",
        "url" : "/",
        "wordCount" : "0",
        "keywords" : [ "Blog" ]
    }
    </script>
        
            
                <title>mdneuzerling</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.42.2" />
        


        
        
            
                <meta name="description" content="data, maths, R">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="mdneuzerling"/>
<meta name="twitter:description" content="data, maths, R"/>
<meta name="twitter:site" content="@mdneuzerling"/>

        <meta property="og:title" content="mdneuzerling" />
<meta property="og:description" content="data, maths, R" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/" />



<meta property="og:updated_time" content="2018-07-01T00:00:00&#43;00:00"/>










        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="mdneuzerling">
<meta itemprop="description" content="data, maths, R">


        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">mdneuzerling</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/scraping-wine-colours-with-r/">Scraping wine colours with R</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-01'>
                                    July 1, 2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/post/scraping-wine-colours-with-r/" class="image featured">
            <img src="/img/grapes.jpeg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/using-r-to-send-an-outlook-email-with-an-inline-image/">Using R to send an Outlook email with an inline image</a></h3>
                                
                                <time class="published" datetime=
                                    '2017-03-19'>
                                    March 19, 2017</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/post/using-r-to-send-an-outlook-email-with-an-inline-image/" class="image featured">
            <img src="/img/sending_an_email_with_rdcomclient.png" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/i-think-i-m-a-data-scientist-now/">I think I&#39;m a data scientist now</a></h3>
                                
                                <time class="published" datetime=
                                    '2016-07-07'>
                                    July 7, 2016</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/we-started-a-maths-and-stats-society-at-our-university-and-everyone-loves-it/">We started a maths and stats society at our university, and everyone loves it</a></h3>
                                
                                <time class="published" datetime=
                                    '2016-03-16'>
                                    March 16, 2016</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/post/we-started-a-maths-and-stats-society-at-our-university-and-everyone-loves-it/" class="image featured">
            <img src="/img/katherine_crochet.jpg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/">Post</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-01'>
                                    July 1, 2018</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            "/post/"
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    
    <div id="main">
        
            <article class="post">
  <header>
    <div class="title">
        
            <h2><a href="/post/scraping-wine-colours-with-r/">Scraping wine colours with R</a></h2>
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2018-07-01'>
            July 1, 2018</time>
        <span class="author"></span>
        
            <p>9 minute read</p>
        
        
    </div>
</header>


  

  
    

    
        
        







  


        
        
        

        <a href="/post/scraping-wine-colours-with-r/" class="image featured">
            <img src="/img/grapes.jpeg" alt="">
        </a>
    


  <div id="content">
    <script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<p>My knowledge of wine covers three facts:</p>
<ol style="list-style-type: decimal">
<li>I like red wine.</li>
<li>I do not like white wine.</li>
<li>I love wine <em>data</em>.</li>
</ol>
<p>I came across a great collection of around 130,000 wine reviews, each a
paragraph long, on <a href="https://www.kaggle.com/zynicide/wine-reviews">Kaggle</a>.
This is juicy stuff, and I can’t wait to dig into it with some text analysis,
or maybe build some sort of markov chain or neural network that generates new
wine reviews.</p>
<p>But I wanted to start with something simple—a little bit of feature
engineering. There’s around 700 different <em>varieties</em> (eg. merlot, riesling)
in here, and I thought it would be easy to add on whether or not they were
red, white or rosé.</p>
<p>It was not.</p>
<p>I won’t show you all the failed attempts; I’ll just focus on what worked in the
end. This is the process:</p>
<ol style="list-style-type: decimal">
<li>Scrape wine colour data from Wikipedia</li>
<li>Join the colours with the wine varieties</li>
<li>Fix errors and duplicates</li>
<li>Improve the wine colour data, and repeat</li>
<li>When all else fails, manually classify what remains.</li>
</ol>
<p>Classifying wine into three simple categories is a tough ask, and I can hear the
connoisseurs tutting at me. Some grapes can be red and white, and I’m told that
there’s such a thing as “orange” wine (and no, it’s not made from
oranges—I did ask). Dessert wines and sparkling wines can probably be
classified as red or white, but really they’re off doing their own thing. I
acknowledge how aggressive this classification is, but I’m going to charge
ahead anyway.</p>
<div id="quick-look-at-the-data" class="section level2">
<h2>Quick look at the data</h2>
<pre class="r"><code>knitr::opts_chunk$set(echo = TRUE, cache = FALSE)

set.seed(42275) # Chosen by fair dice roll. Guaranteed to be random.
 
library(tidyverse)
library(ggplot2) 
library(rvest)
library(kableExtra)

# nifty function for making our table output pretty
output_table &lt;- function(dat) {
    knitr::kable(dat, format = &quot;html&quot;) %&gt;% 
        kable_styling(full_width = F)
}

red_wine_colour &lt;- &quot;#59121C&quot;
white_wine_colour &lt;- &quot;#EADB9F&quot;
rose_wine_colour &lt;- &quot;#F5C0A2&quot;

wine &lt;- &quot;wine_reviews.csv&quot; %&gt;% 
    read_csv %&gt;% 
    mutate(variety = variety %&gt;% tolower)</code></pre>
<p>I think this data will keep me entertained for a while. There’s a lot to dig
into here, and those reviews are going to be interesting when I can pull them
apart. For example, 7
wines are described as tasting of tennis balls, and these wines are rated
about average. It makes me think that I’m not spending enough time in life
appreciating the taste of tennis balls. Dogs understand this.</p>
<p>Speaking of points, it appears as though wines are ranked on a scale from 80
to 100. Although, looking at the plot below, you’d be forgiven for thinking that
the scale is from 80 to 97. Only 0.01% of wines make it to a rating of 100.</p>
<pre class="r"><code>wine %&gt;% ggplot(aes(x = points)) + 
    geom_histogram(
        bins = nrow(wine %&gt;% distinct(points)),
        colour = &quot;white&quot;,
        fill = red_wine_colour
    )</code></pre>
<p><img src="/post/2018-07-01-scraping-wine-colours-with-r_files/figure-html/points-1.png" width="672" /></p>
<p>The review below is for an 80-point wine, and it’s certainly one of my
favourite descriptions:</p>
<pre class="r"><code>wine %&gt;% 
    filter(X1 == 11086) %&gt;% 
    select(description) %&gt;% 
    paste0(&#39;&gt; &#39;, .) %&gt;% # print as quote
    cat</code></pre>
<blockquote>
<p>Picture grandma standing over a pot of stewed prunes, which fill the dusty old house with their sickly aromas. Cooked, earthy and rustic, this wine has little going for it. Just barely acceptable.</p>
</blockquote>
<p>One wine, indexed 86909, has a missing variety. Fortunately, we can recover the
information from the review:</p>
<pre class="r"><code>wine %&gt;% 
    filter(X1 == 86909) %&gt;% 
    select(description) %&gt;% 
    paste0(&#39;&gt; &#39;, .) %&gt;% # print as quote
    cat</code></pre>
<blockquote>
<p>A chalky, dusty mouthfeel nicely balances this Petite Syrah’s bright, full blackberry and blueberry fruit. Wheat-flour and black-pepper notes add interest to the bouquet; the wine finishes with herb and an acorny nuttiness. A good first Chilean wine for those more comfortable with the Californian style. It’s got tannins to lose, but it’s very good.</p>
</blockquote>
<pre class="r"><code>wine &lt;- wine %&gt;% mutate(
  variety = ifelse(X1 == 86909, &quot;petite syrah&quot;, variety)
)</code></pre>
</div>
<div id="scraping-wikipedia" class="section level2">
<h2>Scraping Wikipedia</h2>
<p>In order to classify the wines as red, white or rosé, we’re going to scrape
wine data from the <a href="https://en.wikipedia.org/wiki/List_of_grape_varieties">List of grape varieties</a>
Wikipedia page, using the <code>rvest</code> package. The first three tables of this page
give red, white and rosé wines, in that order.</p>
<pre class="r"><code>wiki_tables &lt;- &quot;https://en.wikipedia.org/wiki/List_of_grape_varieties&quot; %&gt;% 
    read_html %&gt;% 
    html_nodes(&quot;table&quot;)
red_wines &lt;- wiki_tables[[1]] %&gt;% html_table %&gt;% cbind(colour = &quot;red&quot;)
white_wines &lt;- wiki_tables[[2]] %&gt;% html_table %&gt;% cbind(colour = &quot;white&quot;)
rose_wines &lt;- wiki_tables[[3]] %&gt;% html_table %&gt;% cbind(colour = &quot;rosé&quot;)
all_wines &lt;- rbind(red_wines, white_wines, rose_wines)
all_wines %&gt;% 
    select(`Common Name(s)`, `All Synonyms`, colour) %&gt;% 
    head(1) %&gt;% 
    output_table</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Common Name(s)
</th>
<th style="text-align:left;">
All Synonyms
</th>
<th style="text-align:left;">
colour
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Abbuoto
</td>
<td style="text-align:left;">
Aboto, Cecubo.
</td>
<td style="text-align:left;">
red
</td>
</tr>
</tbody>
</table>
<p>We’re interested in three columns here: <code>Common Name(s)</code>, <code>All Synonyms</code> and
the <code>colour</code> column we defined from the table scraping. We will take the
opportunity to rename the columns to match the tidyverse style.</p>
<p>Apart from synonyms, some wines can also have multiple common names, eg.
“shiraz / syrah”. The synonyms seem to be very broad, and can include some
unexpected results: pinot grigio (also known as pinot gris) is used to produce
white wine, yet it appears as a synonym to canari noir, which is used to make
red wine.</p>
<p>We’re going to preference the common names over the synonyms, so that in any
conflict we use the colour as given by the common name. To do this, we’re going
to <code>unnest</code> the common names and clean the results so that all entries are in
lower-case, the results are distinct, and certain stray bits of punctuation are
removed. We’re then going to do the same with the synonyms, but when we combine
the results we will ignore all entries that are already provided by the common
names.</p>
<p>The end result will be a single table with two columns: <code>variety</code>, and <code>colour</code>.
The table may very well still contain duplicates, but certainly less than we
would have had if we had treated common names and synonyms as equals.</p>
<pre class="r"><code>all_wines_cleaned &lt;- all_wines %&gt;% 
    rename(
        common_names = `Common Name(s)`,
        synonyms = `All Synonyms`
    ) %&gt;% 
    mutate_all(tolower) %&gt;% 
    select(common_names, synonyms, colour)

common_names &lt;- all_wines_cleaned %&gt;%
    unnest(common_names = strsplit(common_names, &quot; / &quot;)) %&gt;% # split common names into separate rows
    rename(variety = common_names) %&gt;% 
    mutate(
        variety = gsub(&quot;\\.&quot;, &quot;&quot;, variety), # remove periods 
        variety = gsub(&quot;\\s*\\([^\\)]+\\)&quot;, &quot;&quot;, variety), # remove brackets and anything within
        variety = gsub(&quot;\\s*\\[[^\\)]+\\]&quot;, &quot;&quot;, variety) # same for square brackets
    ) %&gt;% 
    select(variety, colour)

synonyms &lt;- all_wines_cleaned %&gt;% 
    unnest(synonyms = strsplit(synonyms, &quot;, &quot;)) %&gt;% # split the synonyms into multiple rows
    rename(variety = synonyms) %&gt;% 
    mutate(
        variety = gsub(&quot;\\.&quot;, &quot;&quot;, variety), # remove periods 
        variety = gsub(&quot;\\s*\\([^\\)]+\\)&quot;, &quot;&quot;, variety), # remove brackets and anything within
        variety = gsub(&quot;\\s*\\[[^\\)]+\\]&quot;, &quot;&quot;, variety) # same for square brackets
    ) %&gt;% 
    select(variety, colour) %&gt;% 
    anti_join(common_names, by = &quot;variety&quot;) # remove synonyms if we have a common name

variety_colours &lt;- rbind(common_names, synonyms) %&gt;% 
    distinct %&gt;% 
    arrange(variety)

variety_colours %&gt;% 
    head %&gt;% 
    output_table</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variety
</th>
<th style="text-align:left;">
colour
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
22 a baco
</td>
<td style="text-align:left;">
white
</td>
</tr>
<tr>
<td style="text-align:left;">
abbondosa
</td>
<td style="text-align:left;">
white
</td>
</tr>
<tr>
<td style="text-align:left;">
abboudossa
</td>
<td style="text-align:left;">
white
</td>
</tr>
<tr>
<td style="text-align:left;">
abbsudosa
</td>
<td style="text-align:left;">
white
</td>
</tr>
<tr>
<td style="text-align:left;">
abbuoto
</td>
<td style="text-align:left;">
red
</td>
</tr>
<tr>
<td style="text-align:left;">
abelione
</td>
<td style="text-align:left;">
white
</td>
</tr>
</tbody>
</table>
<p>The end result is 8469 rows, with plenty of repeated
entries to accommodate for multiple names or variations in spelling.</p>
</div>
<div id="joining-the-colour-data" class="section level2">
<h2>Joining the colour data</h2>
<p>Now we join the colours with the wine data. If there are any missing values, we
can attempt to fill them in based on obvious clues in the variety (eg. a “Red
blend” can safely be assumed to be a red wine). We’re going to repeat this
join as we iteratively improve the <code>variety_colours</code> data, so we’ll define it
as a function.</p>
<pre class="r"><code>join_with_variety_colours &lt;- function(wine, variety_colours) {
    wine %&gt;% 
        left_join(
            variety_colours %&gt;% select(variety, colour),
            by = &quot;variety&quot;
        ) %&gt;% 
        mutate(
            colour = case_when(
                !is.na(colour) ~ colour,
                grepl(&quot;sparkling&quot;, variety, ignore.case = TRUE) ~ &quot;white&quot;,
                grepl(&quot;champagne&quot;, variety, ignore.case = TRUE) ~ &quot;white&quot;,
                grepl(&quot;red&quot;, variety, ignore.case = TRUE) ~ &quot;red&quot;,
                grepl(&quot;white&quot;, variety, ignore.case = TRUE) ~ &quot;white&quot;,
                grepl(&quot;rosé&quot;, variety, ignore.case = TRUE) ~ &quot;rosé&quot;,
                grepl(&quot;rose&quot;, variety, ignore.case = TRUE) ~ &quot;rosé&quot;
            )
        )
}

wine_colours &lt;- wine %&gt;% join_with_variety_colours(variety_colours)

plot_wine_colours &lt;- function(wine_colours) {
    wine_colours %&gt;% 
    ggplot(aes(x = colour, fill = colour)) + 
    geom_bar() + 
    scale_fill_manual(values = c(
        &quot;red&quot; = red_wine_colour, 
        &quot;white&quot; = white_wine_colour, 
        &quot;rosé&quot; = rose_wine_colour),
        na.value = &quot;grey&quot;
    ) + 
    ggtitle(&quot;Wine colours&quot;) +
    theme(legend.position=&quot;none&quot;)
}

plot_wine_colours(wine_colours)</code></pre>
<p><img src="/post/2018-07-01-scraping-wine-colours-with-r_files/figure-html/join_with_variety_colours-1.png" width="672" /></p>
<p>All but 6709 wines have been
classified. We still have some colours missing, but first we consider the wines
that have been classified as multiple colours:</p>
<pre class="r"><code>wine_colours %&gt;% 
    distinct(variety, colour) %&gt;% 
    count(variety) %&gt;% 
    filter(n &gt; 1) %&gt;% 
    output_table</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variety
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
alicante
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
grignolino
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
malvasia fina
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
sauvignon
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>We use web searches to manually classify the varieties based on the colour of
the wine that is most often produced from them.</p>
<pre class="r"><code>variety_colours &lt;- variety_colours %&gt;% 
    filter(!(variety == &quot;alicante&quot; &amp; colour != &quot;red&quot;)) %&gt;%     
    filter(!(variety == &quot;grignolino&quot; &amp; colour != &quot;red&quot;)) %&gt;% 
    filter(!(variety == &quot;malvasia fina&quot; &amp; colour != &quot;white&quot;)) %&gt;% # rarely red
    filter(!(variety == &quot;sauvignon&quot; &amp; colour != &quot;white&quot;))</code></pre>
<p>The below suggests that blends are not being classified:</p>
<pre class="r"><code>wine_colours %&gt;% 
    filter(is.na(colour)) %&gt;% 
    count(variety, sort = TRUE) %&gt;% 
    head(10) %&gt;% 
    output_table</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variety
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
port
</td>
<td style="text-align:right;">
668
</td>
</tr>
<tr>
<td style="text-align:left;">
corvina, rondinella, molinara
</td>
<td style="text-align:right;">
619
</td>
</tr>
<tr>
<td style="text-align:left;">
tempranillo blend
</td>
<td style="text-align:right;">
588
</td>
</tr>
<tr>
<td style="text-align:left;">
carmenère
</td>
<td style="text-align:right;">
575
</td>
</tr>
<tr>
<td style="text-align:left;">
meritage
</td>
<td style="text-align:right;">
260
</td>
</tr>
<tr>
<td style="text-align:left;">
g-s-m
</td>
<td style="text-align:right;">
181
</td>
</tr>
<tr>
<td style="text-align:left;">
mencía
</td>
<td style="text-align:right;">
178
</td>
</tr>
<tr>
<td style="text-align:left;">
cabernet sauvignon-merlot
</td>
<td style="text-align:right;">
117
</td>
</tr>
<tr>
<td style="text-align:left;">
nerello mascalese
</td>
<td style="text-align:right;">
117
</td>
</tr>
<tr>
<td style="text-align:left;">
rosato
</td>
<td style="text-align:right;">
103
</td>
</tr>
</tbody>
</table>
<p>We operate under the assumption that if multiple wines are listed, the first
wine determines the colour. For example, cabernet is red and sauvignon is white,
but cabernet sauvignon is red. We try to classify the unclassified wines again
but using only the first word in their varieties. We split the variety by either
spaces or dashes.</p>
<pre class="r"><code>blend_colours &lt;- 
    wine_colours %&gt;% 
    filter(is.na(colour)) %&gt;% 
    select(variety) %&gt;% 
    rowwise %&gt;% 
    mutate(first_variety = unlist(strsplit(variety, &quot;\\-|\\ | &quot;))[1]) %&gt;% 
    merge(variety_colours, by.x = &quot;first_variety&quot;, by.y = &quot;variety&quot;) %&gt;% 
    select(variety, colour) %&gt;% 
    distinct</code></pre>
<p>Now we can rebuild the wine colours using these new blend results:</p>
<pre class="r"><code>wine_colours &lt;- wine %&gt;% join_with_variety_colours(
    rbind(variety_colours, blend_colours)
) 

plot_wine_colours(wine_colours)</code></pre>
<p><img src="/post/2018-07-01-scraping-wine-colours-with-r_files/figure-html/join_with_blend_colours-1.png" width="672" /></p>
<p>All but 4066 wines have been
classified. This is an improvement, but we still have to classify the rest.</p>
</div>
<div id="manual-classifications" class="section level2">
<h2>Manual classifications</h2>
<p>We manually classify the remaining
153
varieties using web searches or the <code>description</code>s (reviews) associated with
the wines.</p>
<pre class="r"><code>manual_colours &lt;- &quot;manually_classified.csv&quot; %&gt;% read_csv</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   variety = col_character(),
##   colour = col_character()
## )</code></pre>
<pre class="r"><code>wine_colours &lt;- wine %&gt;% join_with_variety_colours(
    rbind(variety_colours, blend_colours, manual_colours)
) 

plot_wine_colours(wine_colours)</code></pre>
<p><img src="/post/2018-07-01-scraping-wine-colours-with-r_files/figure-html/manual_colours-1.png" width="672" /></p>
<p>And we’re there! As I said earlier, this is a somewhat aggressive
classification. But we’ve got the most popular wines—the pinot noirs and the
chardonnays—classified, and we can hope that any errors are only “kind of
wrong” rather than “totally wrong”, and limited to the varieties that only
appear once or twice.</p>
</div>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="/tags/r">r</a></li>
                
                
                <li><a class="article-category-link" href="/tags/r-markdown">R Markdown</a></li>
                
                
                <li><a class="article-category-link" href="/tags/wine">wine</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "shortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/post/using-r-to-send-an-outlook-email-with-an-inline-image/"
                class="button big previous">Using R to send an Outlook email with an inline image</a></li>
    

    
</ul>



            <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=%2fpost%2fscraping-wine-colours-with-r%2f&amp;text=Scraping%20wine%20colours%20with%20R&amp;via=mdneuzerling" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=%2fpost%2fscraping-wine-colours-with-r%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2fpost%2fscraping-wine-colours-with-r%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2fpost%2fscraping-wine-colours-with-r%2f&amp;title=Scraping%20wine%20colours%20with%20R" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2fpost%2fscraping-wine-colours-with-r%2f&amp;title=Scraping%20wine%20colours%20with%20R" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=%2fpost%2fscraping-wine-colours-with-r%2f&amp;title=Scraping%20wine%20colours%20with%20R" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=%2fpost%2fscraping-wine-colours-with-r%2f&amp;description=Scraping%20wine%20colours%20with%20R" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=%2fpost%2fscraping-wine-colours-with-r%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

        
    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="https://avatars3.githubusercontent.com/u/14957706?s=460&amp;v=4" class="intro-circle" width="250px" alt="mdneuzerling" /></a>
      
    
    
      <header>
        <h2>Murray David Neuzerling</h2>
        <p>Data, maths, R</p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/mdneuzerling" target="_blank" title="GitHub" class="fa fa-github"></a></li>



























































  <li><a href="//twitter.com/mdneuzerling" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/scraping-wine-colours-with-r/">Scraping wine colours with R</a>
              </h3>
              
              <time class="published" datetime='2018-07-01'>
                July 1, 2018
              </time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/post/scraping-wine-colours-with-r/" class="image featured">
            <img src="/img/grapes.jpeg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/using-r-to-send-an-outlook-email-with-an-inline-image/">Using R to send an Outlook email with an inline image</a>
              </h3>
              
              <time class="published" datetime='2017-03-19'>
                March 19, 2017
              </time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/post/using-r-to-send-an-outlook-email-with-an-inline-image/" class="image featured">
            <img src="/img/sending_an_email_with_rdcomclient.png" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/i-think-i-m-a-data-scientist-now/">I think I&#39;m a data scientist now</a>
              </h3>
              
              <time class="published" datetime='2016-07-07'>
                July 7, 2016
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/we-started-a-maths-and-stats-society-at-our-university-and-everyone-loves-it/">We started a maths and stats society at our university, and everyone loves it</a>
              </h3>
              
              <time class="published" datetime='2016-03-16'>
                March 16, 2016
              </time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/post/we-started-a-maths-and-stats-society-at-our-university-and-everyone-loves-it/" class="image featured">
            <img src="/img/katherine_crochet.jpg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/">Post</a>
              </h3>
              
              <time class="published" datetime='2018-07-01'>
                July 1, 2018
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            "/post/"
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  

  
  

  
  <section id="footer">
    
    <p class="copyright">
      
        &copy; 2018
        
          mdneuzerling
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

