<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>
Model as a package
</title>

    


  
  <meta name="author" content="David Neuzerling" />
  <meta name="description" content="" />



<meta name="generator" content="Hugo 0.71.1" />

<link rel="canonical" href="/post/model-as-a-package/" />


<meta property="og:title" content="Model as a package" />
<meta property="og:description" content="There’s a concept in R of an analysis as a package, in which everything you need for your data analysis is contained within a custom package. When you install the package and build the vignettes, the data analysis is performed and results saved as a pretty HTML or PDF file, generated with R Markdown. I wanted to extend this concept to a machine learning model as a package.
The idea here is that, using vignettes, we can make equivalent installing a package with training a model." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/model-as-a-package/" />
<meta property="article:published_time" content="2019-12-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-11T00:00:00+00:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Model as a package"/>
<meta name="twitter:description" content="There’s a concept in R of an analysis as a package, in which everything you need for your data analysis is contained within a custom package. When you install the package and build the vignettes, the data analysis is performed and results saved as a pretty HTML or PDF file, generated with R Markdown. I wanted to extend this concept to a machine learning model as a package.
The idea here is that, using vignettes, we can make equivalent installing a package with training a model."/>


<link rel="stylesheet" href="/css/github-markdown.css" />
<link rel="stylesheet" href="/css/semantic.min.css" />
<link rel="stylesheet" href="/css/site.css" />
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet"> 
<link rel="stylesheet" href="/css/customisation.css" />
<link rel="stylesheet" href="/css/solarized-dark.css" rel="stylesheet" id="theme-stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<style>
  a {
    color: seagreen !important;
  }
</style>



<style>
  .inverted a {
     color: darkseagreen !important;
  }
</style>


  </head>

  
  <body style="background: black;">
  
    <div class="flip-container">
      <div class="flipper">
        <section class="front">
          
<nav class="ui secondary inverted menu dream-menu">

  <div class="item">
    <i class="large link home icon" title="Home" onclick="window.location.href = '\/'"></i>
  </div>
  <div class="item">
    <i class="large link icon theme-switch" onclick="themeSwitch()"></i>
  </div>
</nav>

          
<div class="ui centered relaxed grid dream-grid">
  <div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single">

    <section class="ui top attached segment" id="dream-save-post-as-img">
      <header style="margin-top: 0 !important;">
        <h2 class="ui header">
          Model as a package
          <div class="sub header">@ David Neuzerling · Wednesday, Dec 11, 2019 · 3 minute read · Update at Dec 11, 2019</div>
        </h2>
      </header>
      <br><a href="#" class="image featured"><img src="/img/ModelAsAPackage.png"></a>
      <article style="margin-top: 2rem;">


<p>There’s a concept in R of an <a href="https://www.r-bloggers.com/creating-an-analysis-as-a-package-and-vignette">analysis as a package</a>, in which everything you need for your data analysis is contained within a custom package. When you install the package and build the vignettes, the data analysis is performed and results saved as a pretty HTML or PDF file, generated with R Markdown. I wanted to extend this concept to a machine learning <strong>model as a package</strong>.</p>
<p>The idea here is that, using vignettes, we can make equivalent installing a package with training a model. The functions in the package can be used in model training or for scoring new data, probably with some overlap. To demonstrate this I’ve created a simple sentiment analysis model based on <a href="https://archive.ics.uci.edu/ml/datasets/Sentiment+Labelled+Sentences">review data from the UCI Machine Learning Repository</a>.</p>
<p><a href="https://github.com/mdneuzerling/ModelAsAPackage">You can check out the repository for the model/package here</a>. I’ve also copied <a href="/rmd/ModelAsAPackage.html">the output of the vignette</a> so you can see what’s knitted when the package is installed. You can install this package with <code>devtools::install_github(&quot;mdneuzerling/ModelAsAPackage&quot;, build_vignettes = TRUE)</code>. The package can be loaded and attached with <code>library(ModelAsAPackage)</code> and the training vignette opened with <code>vignette(&quot;model-training&quot;, package = &quot;ModelAsAPackage&quot;)</code>.</p>
<p>Want to see the (not-so-great) model score some text? Try giving an argument to the <code>sentiment</code> function. I’m happy to report that <code>sentiment(&quot;love&quot;) == &quot;good&quot;</code>.</p>
<p>I thought this might work because of a few things:</p>
<ul>
<li>Vignettes are created before the source code is bundled, so in theory we can train a model before the package has finished compiling.</li>
<li>R uses lazy evaluation, so if a package function refers to an object that doesn’t yet exist (because it hasn’t been created by the vignette) that’s okay.</li>
<li>I like using the same functions for model training as I do for model scoring, like the <code>map_to_dtm</code> function in this package.</li>
<li>I wanted to take full advantage of <code>roxygen2</code> for documenting package functions, and <code>testthat</code> for unit tests. I especially like the ease with which you can test within RStudio.</li>
</ul>
<p>However, I have my doubts:</p>
<ul>
<li>In order for tests to work, I have to run <code>devtools::build_vignettes</code> before running <code>devtools::install</code>. There’s something here with namespaces whereby the data objects suddenly become “unexported” after tests are attempted. I don’t know why!</li>
<li>There are some relative paths in the code. I’m assuming that the working directory is <code>&lt;package_root&gt;/vignettes</code> when this vignette is knitted, so I can move up one level to obtain the root directory of the package. This should be okay if we’re following the standard package structure, but I’ve been hurt too many times by relative file paths to feel comfortable about this.</li>
<li>I’m not sure how this would operate with the <code>plumber</code> package. I don’t know if we can integrate the expected <code>plumber.R</code> function in the package, except for sticking it in the <code>inst</code> directory and then finding it with <code>system.file</code>.</li>
<li>This all seems like a lot of complexity for not too much benefit. Maybe doing this again would be easier now that I have a template.</li>
</ul>
<p>These sorts of projects should be shared, even if I don’t think that this is a major success!</p>
<p>A quick shout out for <a href="http://r-pkgs.had.co.nz/">the excellent book on R packages by Hadley Wickham</a>. It’s well worth keeping bookmarked.</p>
</article>
    </section>

    <footer class="ui attached segment dream-tags">
      
        
          <a class="ui label" href="/tags/r" title="R">R</a>
        
      
      <div
        class="ui label"
        style="float: right; background: #1b1c1d !important; cursor: pointer;"
        onclick="savePostAsImg()">
        <i class="save icon"></i> Save as image
      </div>
    </footer>

    

    

  </div>
  <div class="sixteen wide mobile sixteen wide tablet four wide computer column">
    <article class="dream-header">
  <section class="ui top attached center aligned segment">
    <div class="ui small circular image">
      
        <img src="/img/profile/profile_1_small.png">
      
    </div>

    <h1 class="ui medium header">David Neuzerling&#39;s blog<div class="sub header" style="margin-top: 0.5rem;">Data, maths, R</div>
    </h1>

    
  </section>

  
  <section class="ui attached center aligned segment dream-tags">
    
      <a class="ui label" href="/tags/conference" title="conference">conference</a>
    
      <a class="ui label" href="/tags/industry" title="industry">industry</a>
    
      <a class="ui label" href="/tags/maths" title="maths">maths</a>
    
      <a class="ui label" href="/tags/r" title="r">r</a>
    
      <a class="ui label" href="/tags/scraping" title="scraping">scraping</a>
    
  </section>
  

  

  <section class="ui attached segment header-socials">
    <nav class="ui secondary menu dream-menu dream-socials">
  

  
    <div class="item">
      <a href="https://twitter.com/mdneuzerling" target="_blank">
        <i class=" twitter icon" title="twitter"></i>
      </a>
    </div>
  

  

  

  

  
    <div class="item">
      <a href="https://github.com/mdneuzerling" target="_blank">
        <i class=" github icon" title="github"></i>
      </a>
    </div>
  

  

  
</nav>

  </section>

  <section class="ui bottom attached center aligned segment">
    
      <p>© 2020 David Neuzerling</p>
    

    <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</br></br>
      Except where otherwise stated, the content of this blog is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 License</a>.</p>
  </section>
</article>

  </div>
</div>

        </section>
        <section class="back">
          
<nav class="ui secondary inverted menu dream-menu">

  <div class="item">
    <i class="large link home icon" title="Home" onclick="window.location.href = '\/'"></i>
  </div>
  <div class="item">
    <i class="large link icon theme-switch" onclick="themeSwitch()"></i>
  </div>
</nav>

          <div class="ui centered relaxed grid dream-grid dream-back">
  

  <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    <article>
      <div class="ui top attached segment">
        <h3 class="ui header">Social Links</h3>
      </div>
      <div class="ui attached segment">
        <nav class="ui secondary menu dream-menu dream-socials">
  

  
    <div class="item">
      <a href="https://twitter.com/mdneuzerling" target="_blank">
        <i class="large twitter icon" title="twitter"></i>
      </a>
    </div>
  

  

  

  

  
    <div class="item">
      <a href="https://github.com/mdneuzerling" target="_blank">
        <i class="large github icon" title="github"></i>
      </a>
    </div>
  

  

  
</nav>

      </div>
    </article>
  </section>

  <section class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    
  </section>

  
  

</div>

        </section>
      </div>
    </div>

    <script src="/js/jquery.min.js"></script>
<script src="/js/semantic.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/nav.js"></script>
<script src="/js/header.js"></script>
<script src="/js/main.js"></script>
<script src="/js/theme.js"></script>
<script src="/js/html2canvas.min.js"></script>



  </body>
</html>
